$(function(){function hidefilter(){filter_canvas_data=null,$(".lefttool").length?$(".filter").hide().css({left:"105px",opacity:0}):$(".bottool").length&&$(".filter").hide().css({bottom:"55px",opacity:0}),$(".boxed").removeClass("boxed")}$.ajax({type:"post",url:"/ajaxPage.html",data:{ajaxtype:1},error:function(){console.log("error")},success:function(data){var zan=$(".zan-music .zan");zan.attr("title",data.zans+"人已赞").find("i").html("赞（"+data.zans+"）")}});var dragable=!0,ijietuCanvas="",jietuable=!1,drag={getObj:function(id){return document.getElementById(id)},inArray:function(v,arr){if("object"==typeof arr&&arr.length){var c=0;if(this.forEach(arr,function(i,itm){return itm===v?(c++,i):void 0}),!c)return-1}},addClass0:function(o,clas){function pushClas(im,cls){if(im.className&&""!=im.className){var clasArr=im.className.split(/\s+/i);drg.forEach(clasArr,function(i,m){-1==drg.inArray(cls,clasArr)&&(clasArr.push(cls),im.className=clasArr.join(" "))})}else im.className=cls}return"object"==typeof o&&(o&&o.length?this.forEach(o,function(index,item){pushClas(item,clas)}):pushClas(o,clas)),this},removeArrItem:function(v,arr){var i=arr.length;if(i)for(;i;)this.forEach(arr,function(i,itm){v===itm&&arr.splice(i,1)}),i--},removeClass:function(o,clas){function removeItem(item,clas){if(item.className&&""!=item.className){var clasArr=item.className.split(/\s+/i);drg.removeArrItem(clas,clasArr),item.className=clasArr.join(" ")}}return"object"==typeof o&&(o&&o.length?this.forEach(o,function(index,item){removeItem(item,clas)}):removeItem(o,clas)),this},noselect:function(o){this.addClass0(o,"noselect"),o.onselectstart=function(){return!1}},selectable:function(o){this.removeClass(o,"noselect"),o.onselectstart=null},forEach:function(obj,fn){for(var i in obj){var x=i,y=obj[i];fn(x,y)}},getClientWidth:function(){return document.documentElement.clientWidth||document.body.clientWidth},getClientHeight:function(){return document.documentElement.clientHeight||document.body.clientHeight},getScrollTop:function(){return document.documentElement.scrollTop||document.body.scrollTop},movingLeft:0,movingTop:0,setMovingLeft:function(l){return this.movingLeft=l,this},setMovingTop:function(t){return this.movingTop=t,this},getMovingLeft:function(){return this.movingLeft},getMovingTop:function(){return this.movingTop},dragable:function(d){var _this=this,moveBar=d.moveBar,moveBox=d.moveBox||moveBar,beforeMove=d.beforeMove,onMoving=d.onMoving,onMoved=d.onMoved,cn=moveBox;moveBar.onmousedown=function(e){this.style.cursor="move";var self=this;beforeMove&&beforeMove(moveBar,moveBox);var start={},rect={},canvasOffset={},scroll={};if(jietuable){canvasOffset={left:cn.offsetLeft,top:cn.offsetTop};var e=DOMresize.getEvent(e);scroll={top:document.body.scrollTop||document.documentElement.scrollTop,left:document.body.scrollLeft||document.documentElement.scrollLeft},start={x:e.clientX+scroll.left,y:e.clientY+scroll.top}}var e=e||window.event,x0=(_this.getScrollTop(),e.clientX-moveBox.offsetLeft),y0=e.clientY-moveBox.offsetTop;return moveBox.setCapture&&moveBox.setCapture(),document.onmousemove=function(e){if(jietuable){console.log(start);var e=DOMresize.getEvent(e);rect.k=e.clientX+scroll.left-start.x,rect.g=e.clientY+scroll.top-start.y,rect.t=start.y,rect.l=start.x,e.clientX+scroll.left>cn.width+canvasOffset.left&&(rect.k=cn.width+canvasOffset.left-start.x-1),e.clientY+scroll.top>cn.height+canvasOffset.top&&(rect.g=cn.height+canvasOffset.top-start.y-1),e.clientX+scroll.left<start.x&&(rect.k=start.x-e.clientX-scroll.left,rect.l=start.x-rect.k+1),e.clientY+scroll.top<start.y&&(rect.g=start.y-e.clientY-scroll.top,rect.t=start.y-rect.g+1),e.clientX+scroll.left<canvasOffset.left&&(rect.k=start.x-canvasOffset.left,rect.l=canvasOffset.left+1),e.clientY+scroll.top<canvasOffset.top+1&&(rect.g=start.y-canvasOffset.top,rect.t=canvasOffset.top+1),null!=document.getElementById("rectOutLine")&&document.body.removeChild(document.getElementById("rectOutLine"));var rectOutLine=document.createElement("div");return rectOutLine.id="rectOutLine",rectOutLine.style.cssText="position:absolute;z-index:11112;width:"+rect.k+"px;height:"+rect.g+"px;border:1px dashed #666;top:"+rect.t+"px;left:"+rect.l+"px;",document.body.appendChild(rectOutLine),!1}var e=e||window.event,x1=(_this.getScrollTop(),e.clientX-x0),y1=e.clientY-y0;return _this.movingLeft=x1,_this.movingTop=y1,onMoving&&onMoving(),moveBox.style.left=_this.movingLeft+"px",moveBox.style.top=_this.movingTop+"px",!1},document.onmouseup=function(){if(self.style.cursor="default",jietuable){null!=document.getElementById("jietuMask")&&document.body.removeChild(document.getElementById("jietuMask"));var jietuMask=document.createElement("div");jietuMask.id="jietuMask",jietuMask.style.cssText="position:absolute;z-index:11111;width:"+cn.width+"px;height:"+cn.height+"px;background:rgba(0,0,0,0.5);top:"+(canvasOffset.top+1)+"px;left:"+(canvasOffset.left+1)+"px;",document.body.appendChild(jietuMask);var rectBox=document.getElementById("rectOutLine");if(rectBox.style.border="0",null==document.getElementById("jietuCanvas")){var jietuCanvas=document.createElement("canvas");jietuCanvas.id="jietuCanvas",jietuCanvas.style.cssText="position:absolute;top:"+rect.t+"px;left:"+rect.l+"px;z-index:11113",document.body.appendChild(jietuCanvas),ijietuCanvas=new HOOC({id:"jietuCanvas",width:rect.k,height:rect.g}),ijietuCanvas.context2D(function(jietucx,jietucn){jietucn.ondblclick=function(){jt(ijietuCanvas)},jietucx.clearRect(0,0,rect.k,rect.g),jietucx.drawImage(cn,rect.l-canvasOffset.left,rect.t-canvasOffset.top,rect.k,rect.g,0,0,rect.k,rect.g)})}return document.onkeypress=function(e){var e=window.event||e;13==e.keyCode&&jt(ijietuCanvas),console.log(e.keyCode)},cn.onmousedown=null,document.onmouseup=null,document.onmousemove=null,!1}onMoved&&onMoved(),moveBar.releaseCapture&&moveBar.releaseCapture(),document.onmousemove=null,document.onmouseup=null},!1}}};$('input[type="range"]').width(129),$(".crtlbar").toggle(function(){$(this).parent().find(".rbtn").hide().end().animate({width:40},300),"block"==$(".rgba").css("display")&&hidergba_save(),"block"==$(".waterprint").css("display")&&hideprint_save()},function(){$(this).parent().animate({width:251},300,function(){$(this).parent().find(".rbtn").show()})}),$("body").click(function(){hidefilter(),"block"==$(".rgba").css("display")&&hidergba_save(),"block"==$(".waterprint").css("display")&&hideprint_save(),$(".setsize").fadeOut()}),$(".setsize,.filter").click(function(event){event.stopPropagation()}),$(".box").click(function(){$(".boxed").removeClass("boxed"),$(this).addClass("boxed")}),$(".toWiden").click(function(){jietuable=!1,hidefilter(),$(".setsize").hide(),$(".btn-active").removeClass("btn-active"),$(this).parent().hasClass("bottool")?($this=$(this),$(".filter-bot").removeClass("filter-bot").addClass("filter-left"),$(".filter").hide().css({left:"105px",opacity:0,top:"210px",bottom:"inherit"}),$(".filter-trabot").removeClass("filter-trabot").addClass("filter-traleft"),$(".bottool").children().hide().end().removeClass("bottool").addClass("lefttool").css("padding-left","0").css("width","90px").animate({height:"100%"},200,function(){$(this).removeClass("toolbar").children().fadeIn(),$this.prop("title","横到底部")})):($this=$(this),$(".filter-left").removeClass("filter-left").addClass("filter-bot"),$(".filter").css({bottom:"55px",opacity:0,left:"812px",top:"inherit"}),$(".filter-traleft").removeClass("filter-traleft").addClass("filter-trabot"),$(".lefttool").children().hide().end().removeClass("lefttool").addClass("bottool").animate({height:"42px"},300,function(){$(this).css("padding-left","210px").animate({width:"100%"}).removeClass("toolbar").children().fadeIn(),$this.prop("title","竖到左边")}))}),$(".ibtn").click(function(event){$(".btn-active").removeClass("btn-active"),$(this).addClass("btn-active"),jietuable="jietu"!=$(this).prop("id")?!1:!0,"block"==$(".rgba").css("display")&&hidergba_save(),"block"==$(".waterprint").css("display")&&hideprint_save(),hidefilter(),$(".setsize").hide(),event.stopPropagation()});var DOMresize={x:function(obj){var startObj=obj.startObj,resizeObj=obj.resizeObj,onresizestart=obj.onresizestart,onresizing=obj.onresizing,onresized=obj.onresized,self=this;startObj.onmousedown=function(e){var e=self.getEvent(e),posX=e.clientX,w=resizeObj.width;onresizestart&&onresizestart(),document.onmousemove=function(e){var e=self.getEvent(e),offsetX=e.clientX-posX;resizeObj.width=w+offsetX,resizeObj.width<=15&&(resizeObj.width=15),this.onselectstart=function(){return!1},document.body.style.cssText="-webkit-user-select:none;",onresizing&&onresizing()},document.onmouseup=function(){onresized&&onresized(),document.onmousemove=null,document.onmouseup=null}}},y:function(obj){var startObj=obj.startObj,resizeObj=obj.resizeObj,onresizestart=obj.onresizestart,onresizing=obj.onresizing,onresized=obj.onresized,self=this;startObj.onmousedown=function(e){var e=self.getEvent(e),posY=e.clientY,h=resizeObj.height;onresizestart&&onresizestart(),document.onmousemove=function(e){var e=self.getEvent(e),offsetY=e.clientY-posY;resizeObj.height=h+offsetY,resizeObj.height<=15&&(resizeObj.height=15),this.onselectstart=function(){return!1},document.body.style.cssText="-webkit-user-select:none;",onresizing&&onresizing()},document.onmouseup=function(){onresized&&onresized(),document.onmousemove=null,document.onmouseup=null}}},o:function(obj){var startObj=obj.startObj,resizeObj=obj.resizeObj,onresizestart=obj.onresizestart,onresizing=obj.onresizing,onresized=obj.onresized,self=this;startObj.onmousedown=function(e){var e=self.getEvent(e),posX=e.clientX,posY=e.clientY,w=resizeObj.width,h=resizeObj.height;onresizestart&&onresizestart(),document.onmousemove=function(e){var e=self.getEvent(e),offsetX=e.clientX-posX;offsetY=e.clientY-posY,resizeObj.width=w+offsetX,resizeObj.height=h+offsetY,resizeObj.width<=15&&(resizeObj.width=15),resizeObj.height<=15&&(resizeObj.height=15),this.onselectstart=function(){return!1},document.body.style.cssText="-webkit-user-select:none;",onresizing&&onresizing()},document.onmouseup=function(){onresized&&onresized(),document.onmousemove=null,document.onmouseup=null}}},getEvent:function(e){return window.event||e}},HOOC=function(obj){if(!(this instanceof HOOC))return new HOOC;var canvas=document.getElementById(obj.id);canvas.width=obj.width||canvas.width,canvas.height=obj.height||canvas.height;var ihooc=this;this.text=obj.text||"Hello,miniPS！",this.author=obj.author||"花满楼",this.canvas=canvas,this.context=canvas.getContext("2d"),this.canvas.canvasOffset=this.canvas.getBoundingClientRect(),this.canvasOffset=this.canvas.canvasOffset,this.resizeCanvas={init:function(file){this.renderResizeBar(file)},renderResizeBar:function(file){this.resizeXbar(file),this.resizeYbar(file),this.resizeObar(file)},getOriginImg:function(file,hidecanvas,hidecx){if(file!=canvas){console.log(1);var img=file.preimg?file.preimg:canvas,wh=file.preimg?file:canvas;hidecanvas.width=wh.width,hidecanvas.height=wh.height,hidecx.clearRect(0,0,canvas.width,canvas.height),hidecx.drawImage(img,0,0,hidecanvas.width,hidecanvas.height)}},showSizeTip:function(e){var e=window.event||e,scroll={top:document.body.scrollTop||document.documentElement.scrollTop,left:document.body.scrollLeft||document.documentElement.scrollLeft};null!=document.getElementById("minipsSizeZip")&&document.body.removeChild(document.getElementById("minipsSizeZip"));var tip=document.createElement("div");tip.id="minipsSizeZip",tip.style.cssText="position:absolute;z-index:11115;left:"+(e.clientX+scroll.left+15)+"px;top:"+(e.clientY+scroll.top-10)+"px;padding:5px 10px;font-size:12px;color:#666;background:#dedede;border-radius:2px;",tip.innerHTML="宽："+canvas.width+"px；高："+canvas.height+"px",document.body.appendChild(tip)},resizeXbar:function(file){var self=this;null!=document.getElementById("resizeXbar")&&document.body.removeChild(document.getElementById("resizeXbar"));var xBar=document.createElement("div"),hidecanvas=document.getElementById("hidecanvas"),hidecx=hidecanvas.getContext("2d"),cx=canvas.getContext("2d");xBar.id="resizeXbar",xBar.style.cssText="cursor:col-resize;width:20px;height:"+(canvas.height-15)+"px;position:absolute;z-index:11111;top:"+canvas.offsetTop+"px;left:"+(canvas.offsetLeft+canvas.width-10)+"px;",document.body.appendChild(xBar),DOMresize.x({startObj:xBar,resizeObj:canvas,onresizestart:function(){console.log(file),"block"==$(".rgba").css("display")&&hidergba_save(),"block"==$(".waterprint").css("display")&&hideprint_save(),self.getOriginImg(file,hidecanvas,hidecx)},onresizing:function(){self.init(file),self.showSizeTip(),self.getOriginImg(file,hidecanvas,hidecx),cx.clearRect(0,0,canvas.width,canvas.height),cx.drawImage(hidecanvas,0,0,canvas.width,canvas.height),ihooc.resetChiCun()},onresized:function(){null!=document.getElementById("minipsSizeZip")&&document.body.removeChild(document.getElementById("minipsSizeZip"))}})},resizeYbar:function(file){var self=this;null!=document.getElementById("resizeYbar")&&document.body.removeChild(document.getElementById("resizeYbar"));var yBar=document.createElement("div"),hidecanvas=document.getElementById("hidecanvas"),hidecx=hidecanvas.getContext("2d"),cx=canvas.getContext("2d");yBar.id="resizeYbar",yBar.style.cssText="cursor:row-resize;height:20px;width:"+(canvas.width-15)+"px;position:absolute;z-index:11111;top:"+(canvas.offsetTop+canvas.height-10)+"px;left:"+canvas.offsetLeft+"px;",document.body.appendChild(yBar),DOMresize.y({startObj:yBar,resizeObj:canvas,onresizestart:function(){self.getOriginImg(file,hidecanvas,hidecx),"block"==$(".rgba").css("display")&&hidergba_save(),"block"==$(".waterprint").css("display")&&hideprint_save()},onresizing:function(){self.init(file),self.showSizeTip(),self.getOriginImg(file,hidecanvas,hidecx),cx.clearRect(0,0,canvas.width,canvas.height),cx.drawImage(hidecanvas,0,0,canvas.width,canvas.height),ihooc.resetChiCun()},onresized:function(){null!=document.getElementById("minipsSizeZip")&&document.body.removeChild(document.getElementById("minipsSizeZip"))}})},resizeObar:function(file){var self=this;null!=document.getElementById("resizeObar")&&document.body.removeChild(document.getElementById("resizeObar"));var oBar=document.createElement("div"),hidecanvas=document.getElementById("hidecanvas"),hidecx=hidecanvas.getContext("2d"),cx=canvas.getContext("2d");oBar.id="resizeObar",oBar.style.cssText="cursor:nw-resize;height:28px;width:28px;position:absolute;z-index:11111;top:"+(canvas.offsetTop+canvas.height-15)+"px;left:"+(canvas.offsetLeft+canvas.width-15)+"px;",document.body.appendChild(oBar),DOMresize.o({startObj:oBar,resizeObj:canvas,onresizestart:function(){self.getOriginImg(file,hidecanvas,hidecx),"block"==$(".rgba").css("display")&&hidergba_save(),"block"==$(".waterprint").css("display")&&hideprint_save()},onresizing:function(){self.init(file),self.showSizeTip(),self.getOriginImg(file,hidecanvas,hidecx),cx.clearRect(0,0,canvas.width,canvas.height),cx.drawImage(hidecanvas,0,0,canvas.width,canvas.height),ihooc.resetChiCun()},onresized:function(){null!=document.getElementById("minipsSizeZip")&&document.body.removeChild(document.getElementById("minipsSizeZip"))}})}},obj.resizeable&&(this.resizeable=obj.resizeable,this.resizeCanvas.init(canvas)),this.fillDefaultText=function(){var icx=this.context;icx.save(),icx.font="30px Arial",icx.fillStyle="#0BB7BE",icx.shadowColor="#bbb",icx.shadowOffsetX=15,icx.shadowOffsetY=8,icx.shadowBlur=5,icx.fillText(this.text,.26*canvas.width,this.canvas.height/2-20,(canvas.width-.26*canvas.width)/2),icx.restore(),icx.fillStyle="#666",icx.font="13px 微软雅黑",icx.fillText("—— "+this.author,.58*canvas.width,this.canvas.height/2+35,(canvas.width-.4*canvas.width)/2)},this.fillDefaultText()};HOOC.fn={context2D:function(fn){fn&&fn(this.context,this.canvas)},getCanvasOffset:function(){return this.canvas.canvasOffset},normalize:function(){},imginfo:{preimg:null,size:0,name:"",type:"jpg",base64:"",width:"",height:""},saveAsImage:function(type,name){if(-1!=navigator.userAgent.toLowerCase().indexOf("msie"))return!1;var dataUrl=this.canvas.toDataURL("image/octet-stream");dataUrl=dataUrl.replace("image/png","image/"+type);var name=-1!=name.toLowerCase().lastIndexOf("."+type.toLowerCase())?name:name+"."+type,a=document.createElement("a");a.href=dataUrl,a.download=name;var event=document.createEvent("MouseEvents");event.initMouseEvent("click",!0,!0,document.defaultView,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(event)},onfile:function(file,fn){var reader=new FileReader,self=this,img=new Image;reader.onload=function(e){var e=window.event||e,src=e.target.result;self.imginfo.base64=src,img.src=src},img.onload=function(){self.imginfo.width=this.width,self.imginfo.height=this.height,self.imginfo.preimg=this,fn&&fn(self.imginfo)},reader.readAsDataURL(file),console.log(file.type),this.imginfo={size:file.size,name:file.name,type:file.type},this.imginfo.type=this.imginfo.type.substr(6),-1!=this.imginfo.type.toLowerCase().indexOf("jpeg")&&(this.imginfo.type="jpg")},createXY:function(l,t){var sStep=5,bStep=50,xWidth=this.canvas.width,yHeight=this.canvas.height,xLeft=l||this.canvas.offsetLeft,yTop=t||this.canvas.offsetTop,sx=Math.floor(xWidth/sStep),bx=Math.floor(xWidth/bStep),sy=Math.floor(yHeight/sStep),by=Math.floor(yHeight/bStep),xArr=[],yArr=[],xCont=document.createElement("div"),yCont=document.createElement("div");xCont.id="minipschicunX",yCont.id="minipschicunY",xCont.style.cssText="width:"+xWidth+"px;height:30px;position:absolute;z-index:11111;left:"+xLeft+"px;top:"+(yTop-30)+"px",yCont.style.cssText="width:30px;height:"+yHeight+"px;position:absolute;z-index:11111;left:"+(xLeft-30)+"px;top:"+yTop+"px";for(var i=0;sx+1>i;i++)i*sStep%bStep!=0&&xArr.push('<div style="width:1px;height:5px;background:#77C2AA;position:absolute;left:'+i*sStep+'px;bottom:0;"></div>');for(var i=1;bx+1>i;i++)xArr.push('<div style="position:absolute;bottom:8px;left:'+(i*bStep-10)+'px;-ms-transform:scale(0.8,0.8);-o-transform:scale(0.8,0.8);-webkit-transform:scale(0.8,0.8);-moz-transform:scale(0.8,0.8);transform:scale(0.8,0.8);font-size:12px;color:#666;">'+i*bStep+'</div><div style="width:1px;height:8px;background:#77C2AA;position:absolute;left:'+i*bStep+'px;bottom:0;"></div>');for(var i=0;sy+1>i;i++)i*sStep%bStep!=0&&yArr.push('<div style="width:5px;height:1px;background:#77C2AA;position:absolute;top:'+i*sStep+'px;right:0;"></div>');for(var i=1;by+1>i;i++)yArr.push('<div style="position:absolute;right:10px;top:'+(i*bStep-8)+'px;-ms-transform:scale(0.8,0.8);-o-transform:scale(0.8,0.8);-moz-transform:scale(0.8,0.8);-webkit-transform:scale(0.8,0.8);transform:scale(0.8,0.8);font-size:12px;color:#666;">'+i*bStep+'</div><div style="width:8px;height:1px;background:#77C2AA;position:absolute;top:'+i*bStep+'px;right:0;"></div>');xCont.innerHTML=xArr.join(""),yCont.innerHTML=yArr.join(""),yCont.innerHTML+='<div style="position:absolute;right:10px;top:-15px;-ms-transform:scale(0.8,0.8);-o-transform:scale(0.8,0.8);-webkit-transform:scale(0.8,0.8);-moz-transform:scale(0.8,0.8);transform:scale(0.8,0.8);font-size:12px;color:#666;">0</div>',document.body.appendChild(xCont),document.body.appendChild(yCont)},showChiCun:function(l,t){this.createXY(l,t)},getChiCunId:function(){return document.getElementById("minipschicunX")},checkChiCun:function(){return null!=this.getChiCunId()},clearChiCun:function(){this.checkChiCun()&&document.body.removeChild(this.getChiCunId()),null!=document.getElementById("minipschicunY")&&document.body.removeChild(document.getElementById("minipschicunY"))},toggleChiCun:function(){this.checkChiCun()?this.clearChiCun():this.showChiCun()},resetChiCun:function(l,t){return this.checkChiCun()&&(this.clearChiCun(),this.showChiCun(l,t)),this}},HOOC.prototype=HOOC.fn;var memery={index:-1,imgData:[],saveOnce:function(data){this.index++,this.imgData[this.index]=data},saveCanvas:function(w,h,data){this.saveOnce({width:w,height:h,data:data}),console.log("index:"+this.index+",length:"+this.imgData)},go:function(step,fn){if(!step||isNaN(step))return!1;var nowIndex=this.index,tarStep=nowIndex+step;tarStep=0>tarStep?0:tarStep,tarStep>this.imgData.length-1&&(tarStep=this.imgData.length-1),this.index=tarStep,fn&&fn(this.imgData[tarStep])}},filter_canvas_data=null,x=500,y=300,hooc=new HOOC({id:"canvas",width:x,height:y,resizeable:!0}),size=null,save=function(){if(null!=document.getElementById("jietuMask"))return!1;if("block"==$("#waterprint").css("display")){var wp=document.getElementById("waterprint"),_wp=document.getElementById("hidecanvas"),pos={x:-(hooc.canvas.offsetLeft-wp.offsetLeft),y:-(hooc.canvas.offsetTop-wp.offsetTop)};hooc.context.drawImage(wp,pos.x,pos.y,wp.width,wp.height),memery.saveCanvas(hooc.canvas.width,hooc.canvas.height,hooc.canvas.getContext("2d").getImageData(0,0,hooc.canvas.width,hooc.canvas.height)),_wp.getContext("2d").drawImage(hooc.canvas,0,0,hooc.canvas.width,hooc.canvas.height),$(".del_waterprint").remove(),$("#waterprint").fadeOut()}hooc.saveAsImage("png","miniPS")},down=document.getElementById("download"),file=document.getElementById("file"),resize=document.getElementById("resize"),exports=document.getElementById("daochu"),biaochi=document.getElementById("biaochi"),huanyuan=document.getElementById("huanyuan"),jietu=document.getElementById("jietu"),xiguan=document.getElementById("xiguan"),lvjing=document.getElementById("lvjing"),undo=document.getElementById("undo"),redo=document.getElementById("redo");biaochi.onclick=function(){hooc.toggleChiCun()},down.onclick=save,file.onchange=function(){return null!=document.getElementById("jietuMask")?!1:void hooc.onfile(this.files[0],function(file){size=file,$("#open").removeClass("btn-active"),canvas.width=file.width,canvas.height=file.height,hooc.resetChiCun().context2D(function(cx,canvas){cx.clearRect(0,0,canvas.width,canvas.height),cx.drawImage(file.preimg,0,0,file.width,file.height),memery.saveCanvas(hooc.canvas.width,hooc.canvas.height,hooc.canvas.getContext("2d").getImageData(0,0,hooc.canvas.width,hooc.canvas.height)),hooc.resizeable&&hooc.resizeCanvas.init(file)}),save=function(){if(null!=document.getElementById("jietuMask"))return!1;if("block"==$("#waterprint").css("display")){var wp=document.getElementById("waterprint"),_wp=document.getElementById("hidecanvas"),pos={x:-(hooc.canvas.offsetLeft-wp.offsetLeft),y:-(hooc.canvas.offsetTop-wp.offsetTop)};hooc.context.drawImage(wp,pos.x,pos.y,wp.width,wp.height),memery.saveCanvas(hooc.canvas.width,hooc.canvas.height,hooc.context.getImageData(0,0,hooc.canvas.width,hooc.canvas.height)),_wp.getContext("2d").drawImage(hooc.canvas,0,0,hooc.canvas.width,hooc.canvas.height),$(".del_waterprint").remove(),$("#waterprint").fadeOut()}hooc.saveAsImage(file.type,file.name)},down.onclick=save})};var hideHooc=new HOOC({id:"hidecanvas",width:x,height:y});hooc.context2D(function(cx,cn){function dragInit(){dragable&&drag.dragable({moveBar:document.getElementById("canvas"),onMoving:function(){var left=drag.getMovingLeft(),top=drag.getMovingTop();console.log(hooc.canvasOffset);var size="";size=hooc.imginfo.preimg?hooc.imginfo:cn,hooc.resetChiCun(left,top),hooc.resizeable&&hooc.resizeCanvas.init(size)},onMoved:function(){}})}memery.saveCanvas(cn.width,cn.height,cx.getImageData(0,0,cn.width,cn.height)),exports.onclick=function(event){return event.stopPropagation(),null!=document.getElementById("jietuMask")?!1:($(".lefttool").length?$(".setsize").css({bottom:"inherit",left:"115px",top:"305px"}).find(".tra").removeClass("trabot").addClass("traleft").end().show().animate({left:"95px",opacity:1},function(){$(".k").focus()}):$(".bottool").length&&$(".setsize").css({top:"inherit",left:"710px",bottom:"65px"}).find(".tra").removeClass("traleft").addClass("trabot").end().show().animate({bottom:"49px",opacity:1},function(){$(".k").focus()}),$(".sized").attr("type",1).click(function(){if(1!=$(this).attr("type"))return!1;var w=$(".k").val()||cn.width,h=$(".g").val()||cn.height;hideHooc.context2D(function(icx,icn){icn.width=w,icn.height=h,icx.clearRect(0,0,w,h),icx.drawImage(cn,0,0,w,h)});var type=hooc.imginfo.preimg?hooc.imginfo.type:"png",na=hooc.imginfo.preimg?hooc.imginfo.name.replace("."+hooc.imginfo.type,"")+"_"+w+"_"+h:"miniPS";if($(".setsize").hide(),$(".btn-active").removeClass("btn-active"),"block"==$("#waterprint").css("display")){var wp=document.getElementById("waterprint"),_wp=document.getElementById("hidecanvas"),pos={x:-(cn.offsetLeft-wp.offsetLeft),y:-(cn.offsetTop-wp.offsetTop)};hooc.context.drawImage(wp,pos.x,pos.y,wp.width,wp.height),memery.saveCanvas(cn.width,cn.height,cx.getImageData(0,0,cn.width,cn.height)),_wp.getContext("2d").drawImage(cn,0,0,cn.width,cn.height),$(".del_waterprint").remove(),$("#waterprint").fadeOut()}hideHooc.saveAsImage(type,na),hideHooc.context2D(function(icx,icn){icn.width=cn.width,icn.height=cn.height,icx.clearRect(0,0,icn.width,icn.height),icx.drawImage(cn,0,0,icn.width,icn.height)})}),!1)},dragInit(),drag.dragable({moveBar:document.getElementById("waterprint"),beforeMove:function(a,b){},onMoving:function(){var left=drag.getMovingLeft(),top=drag.getMovingTop();$(".del_waterprint").css({top:top+"px",left:left+$(".charsss").width()+20+2+"px"}).click(function(){$(this).remove(),$("#waterprint").fadeOut()})},onMoved:function(){}}),resize.onclick=function(event){return event.stopPropagation(),null!=document.getElementById("jietuMask")?!1:($(".lefttool").length?$(".setsize").css({bottom:"inherit",left:"115px",top:"273px"}).find(".tra").removeClass("trabot").addClass("traleft").end().show().animate({left:"95px",opacity:1},function(){$(".k").focus()}):$(".bottool").length&&$(".setsize").css({top:"inherit",left:"620px",bottom:"65px"}).find(".tra").removeClass("traleft").addClass("trabot").end().show().animate({bottom:"49px",opacity:1},function(){$(".k").focus()}),$(".sized").attr("type",2).click(function(){return 2!=$(this).attr("type")?!1:""==$(".k").val()||""==$(".g").val()?!1:void hideHooc.context2D(function(rcx,rcn){var size=hooc.imginfo.preimg?hooc.imginfo:cn;rcn.width=size.width,rcn.height=size.height,rcx.clearRect(0,0,rcn.width,rcn.height),rcx.drawImage(cn,0,0,rcn.width,rcn.height),cn.width=$(".k").val(),cn.height=$(".g").val(),cx.drawImage(rcn,0,0,cn.width,cn.height),memery.saveCanvas(cn.width,cn.height,cx.getImageData(0,0,cn.width,cn.height)),hooc.resetChiCun(),hooc.resizeable&&hooc.resizeCanvas.init(size),console.log("size:"+size),$(".setsize").hide(),$(".btn-active").removeClass("btn-active")})}),!1)},huanyuan.onclick=function(){clearJieTu();var size="";if(hooc.imginfo.preimg){size=hooc.imginfo;var img=hooc.imginfo;cn.width=img.width,cn.height=img.height,cx.clearRect(0,0,cn.width,cn.height),cx.drawImage(img.preimg,0,0,cn.width,cn.height)}else size=cn,cn.width=x,cn.height=y,hooc.fillDefaultText(),hideHooc.context2D(function(hcx,hcn){hcn.width=x,hcn.height=y,hcx.clearRect(0,0,x,y),hcx.drawImage(cn,0,0,x,y)});memery.saveCanvas(cn.width,cn.height,cx.getImageData(0,0,cn.width,cn.height)),hooc.resetChiCun(),hooc.resizeable&&hooc.resizeCanvas.init(size)};var clearJieTu=function(){null!=document.getElementById("jietuMask")&&(jietuable=!1,dragable=!0,dragInit(),$("#jietu").removeClass("btn-active"),document.body.removeChild(document.getElementById("rectOutLine")),document.body.removeChild(document.getElementById("jietuMask")),document.body.removeChild(document.getElementById("jietuCanvas")))};window.jt=function(ijietuCanvas){cn.width=ijietuCanvas.canvas.width,cn.height=ijietuCanvas.canvas.height,cx.clearRect(0,0,cn.width,cn.height),cx.drawImage(ijietuCanvas.canvas,0,0,cn.width,cn.height),hooc.resetChiCun(),hooc.resizeable&&hooc.resizeCanvas.init(cn),hideHooc.context2D(function(hicx,hicn){hicn.width=cn.width,hicn.height=cn.height,hicx.clearRect(0,0,cn.width,cn.height),hicx.drawImage(cn,0,0,cn.width,cn.height)}),clearJieTu(),memery.saveCanvas(cn.width,cn.height,cx.getImageData(0,0,cn.width,cn.height))},jietu.onclick=function(){jietuable=!0,dragable=!1},xiguan.onclick=function(){jietuable=!1,cn.onmousemove=function(e){var e=window.event||e,dot={x:e.clientX-cn.offsetLeft,y:e.clientY-cn.offsetTop},datas=(dot.x*dot.y*4,cx.getImageData(dot.x,dot.y,1,1).data),png=!0,imginfo=hooc.imginfo,color="",rgba="",rgb="",color16="#";if(imginfo.preimg&&-1==imginfo.type.indexOf("png")&&(png=!1),png)rgba="rgba("+datas[0]+","+datas[1]+","+datas[2]+","+datas[3]+")",color=rgba;else{rgb="rgba("+datas[0]+","+datas[1]+","+datas[2]+")";var add0=function(m){return m.length<2?"0"+m:m};color16+=datas[0]<10?"0"+datas[0]:add0(datas[0].toString(16)),color16+=datas[1]<10?"0"+datas[1]:add0(datas[1].toString(16)),color16+=datas[2]<10?"0"+datas[2]:add0(datas[2].toString(16)),color=color16}console.log(color),cn.onclick=function(){jietuable=!1,document.body.style.background=color,document.getElementById("xiguancolor").value=color,$(".btn-active").removeClass("btn-active"),cn.onmousemove=null},document.getElementById("xiguancolor").value=color}};var reset_rgba={r:function(imgData,_r){for(var i=0;i<imgData.data.length;i+=4){var r=imgData.data[i];imgData.data[i]=r*_r/100}return imgData},g:function(imgData,_g){for(var i=1;i<imgData.data.length;i+=4){var r=imgData.data[i];imgData.data[i]=r*_g/100}return imgData},b:function(imgData,_b){for(var i=2;i<imgData.data.length;i+=4){var r=imgData.data[i];imgData.data[i]=r*_b/100}return imgData},a:function(imgData,_a){for(var i=3;i<imgData.data.length;i+=4){var r=imgData.data[i];imgData.data[i]=r*_a/100}return imgData}};window.hidergba=function(){$(".rbtn-active").removeClass("rbtn-active"),$(".rgba").slideUp(200),$('.rgba input[type="range"]').each(function(){$(this).val(100).next().html($(this).val()+"%")})},window.hideprint=function(){$(".rbtn-active").removeClass("rbtn-active"),$(".waterprint").slideUp(200)},window.hidergba_save=function(){memery.saveCanvas(cn.width,cn.height,cx.getImageData(0,0,cn.width,cn.height)),$(".rbtn-active").removeClass("rbtn-active"),$(".rgba").slideUp(200),$('.rgba input[type="range"]').each(function(){$(this).val(100).next().html($(this).val()+"%")})},window.hideprint_save=function(){$(".rbtn-active").removeClass("rbtn-active"),$(".waterprint").slideUp(200)};var rgbacn=$("#rgba")[0],rgbacx=rgbacn.getContext("2d"),rgbadata=null;$(".resetcolor").click(function(){return $(".rbtn-active").removeClass("rbtn-active"),$(this).addClass("rbtn-active"),$(".rgba").slideDown(200),$(".waterprint").hide(),rgbacn.width=cn.width,rgbacn.height=cn.height,rgbadata=cx.getImageData(0,0,cn.width,cn.height),rgbacx.clearRect(0,0,cn.width,cn.height),rgbacx.drawImage(cn,0,0,cn.width,cn.height),!1}),$(".rgba,.waterprint").click(function(){return!1}),$('input[type="radio"],.lber').click(function(event){event.stopPropagation(),$(this).siblings('input[type="radio"]').removeAttr("checked"),$(this).attr("checked","checked")}),$('.rgba input[type="range"]').each(function(){$(this).change(function(){rgbacn.width=cn.width,rgbacn.height=cn.height,rgbacx.clearRect(0,0,cn.width,cn.height),rgbacx.putImageData(rgbadata,0,0),$(this).next().html($(this).val()+"%");var _data=rgbacx.getImageData(0,0,cn.width,cn.height);cx.clearRect(0,0,cn.width,cn.height),$(this).hasClass("r")&&(_data=reset_rgba.r(_data,$(".r").val())),$(this).hasClass("gg")&&(_data=reset_rgba.g(_data,$(".gg").val())),$(this).hasClass("b")&&(_data=reset_rgba.b(_data,$(".b").val())),$(this).hasClass("a")&&(_data=reset_rgba.a(_data,$(".a").val())),cx.putImageData(_data,0,0,0,0,rgbacn.width,rgbacn.height),hideHooc.canvas.width=cn.width,hideHooc.canvas.height=cn.height,hideHooc.context.clearRect(0,0,cn.width,cn.height),hideHooc.context.drawImage(cn,0,0,cn.width,cn.height)})}),$(".y").click(function(){memery.saveCanvas(cn.width,cn.height,cx.getImageData(0,0,cn.width,cn.height));var size="";size=hooc.imginfo.preimg?hooc.imginfo:cn,hooc.resizeable&&hooc.resizeCanvas.init(size),hidergba()}),$(".n").click(function(){cx.clearRect(0,0,cn.width,cn.height),cx.drawImage(rgbacn,0,0,cn.width,cn.height),hidergba()});var wp={getStyle:function(){var self=this,str=$(".words").val()||"famanoder.com",bb=$('input.bold[checked="checked"]').val(),fs=$(".font").val()||"18px";
return{text:str,size:fs,type:$(".ftype").val()||"微软雅黑",color:$(".fcolor").val()||"rgba(255,255,255,0.8)",bgcolor:$(".fbg").val()||"none",bold:bb,i:$('input.ii[checked="checked"]').val(),width:self.getWidth(str,bb,fs).width,height:self.getWidth(str,bb,fs).height,fstyle:$('input.fstyle[checked="checked"]').val()}},getWidth:function(str,b,fs){$(".charsss").length&&$(".charsss").remove();var charsss=$('<div class="charsss">'+str+"</div>");return charsss.css({position:"absolute","line-height":1,"font-size":parseInt(fs)+"px","font-weight":b,display:"none"}).appendTo($("body")),{width:charsss.width(),height:charsss.height()}}};$(".waterpr").click(function(){return $(".rbtn-active").removeClass("rbtn-active"),$(this).addClass("rbtn-active"),$(".rgba").hide(),$(".waterprint").slideDown(200),!1});var wpcn=$("#waterprint")[0],wpcx=wpcn.getContext("2d");$(".yy").click(function(){var wpstyle=({top:document.body.scrollTop||document.documentElement.scrollTop,left:document.body.scrollLeft||document.documentElement.scrollLeft},wp.getStyle());wpcn.width=wpstyle.width+20,wpcn.height=wpstyle.height+20,$("#waterprint").show().css({top:cn.offsetTop+10+"px",left:cn.offsetLeft+cn.width-wpcn.width-10+"px"}),wpcx.save(),wpcx.fillStyle=wpstyle.bgcolor,wpcx.clearRect(0,0,wpcn.width,wpcn.height),wpcx.fillRect(0,0,wpcn.width,wpcn.height),wpcx.restore(),wpcx.save(),wpcx.font=""+wpstyle.i+" "+wpstyle.bold+" "+wpstyle.size+" "+wpstyle.type,1==wpstyle.fstyle?wpcx.strokeStyle=wpstyle.color:wpcx.fillStyle=wpstyle.color,wpcx.textBaseline="top",1==wpstyle.fstyle?wpcx.strokeText(wpstyle.text,10,6):wpcx.fillText(wpstyle.text,10,6),wpcx.restore();var pos={top:wpcn.offsetTop,left:wpcn.offsetLeft+wpcn.offsetWidth};$(".del_waterprint").length&&$(".del_waterprint").remove(),$('<div class="del_waterprint">×</div>').css({position:"absolute",top:pos.top+"px",left:pos.left+"px",padding:"0 5px",background:"rgba(0,0,0,0.25)",zIndex:"11115","font-size":"16px",color:"#fff",cursor:"pointer"}).appendTo($("body")).click(function(){$(this).remove(),$("#waterprint").fadeOut()}),hideprint()}),$(".nn").click(function(){hideprint()});var filters={gray:function(imgData){for(var i=0;i<imgData.data.length;i++){var r=imgData.data[4*i],g=imgData.data[4*i+1],b=imgData.data[4*i+2],aver=(imgData.data[4*i+3],(r+g+b)/3);imgData.data[4*i]=aver,imgData.data[4*i+1]=aver,imgData.data[4*i+2]=aver}return imgData},fanse:function(imgData){for(var i=0;i<imgData.data.length;i++){var r=imgData.data[4*i],g=imgData.data[4*i+1],b=imgData.data[4*i+2];imgData.data[4*i+3];imgData.data[4*i]=255-r,imgData.data[4*i+1]=255-g,imgData.data[4*i+2]=255-b}return imgData},fudiao:function(tempCanvasData,canvasData){for(var x=1;x<tempCanvasData.width-1;x++)for(var y=1;y<tempCanvasData.height-1;y++){var idx=4*(x+y*tempCanvasData.width),bidx=4*(x-1+y*tempCanvasData.width),aidx=4*(x+1+y*tempCanvasData.width),nr=tempCanvasData.data[aidx+0]-tempCanvasData.data[bidx+0]+128,ng=tempCanvasData.data[aidx+1]-tempCanvasData.data[bidx+1]+128,nb=tempCanvasData.data[aidx+2]-tempCanvasData.data[bidx+2]+128;nr=0>nr?0:nr>255?255:nr,ng=0>ng?0:ng>255?255:ng,nb=0>nb?0:nb>255?255:nb,canvasData.data[idx+0]=nr,canvasData.data[idx+1]=ng,canvasData.data[idx+2]=nb,canvasData.data[idx+3]=255}return canvasData},blur:function(tempCanvasData,canvasData){for(var sumred=0,sumgreen=0,sumblue=0,x=0;x<tempCanvasData.width;x++)for(var y=0;y<tempCanvasData.height;y++){for(var idx=4*(x+y*tempCanvasData.width),subCol=-2;2>=subCol;subCol++){var colOff=subCol+x;(0>colOff||colOff>=tempCanvasData.width)&&(colOff=0);for(var subRow=-2;2>=subRow;subRow++){var rowOff=subRow+y;(0>rowOff||rowOff>=tempCanvasData.height)&&(rowOff=0);var idx2=4*(colOff+rowOff*tempCanvasData.width),r=tempCanvasData.data[idx2+0],g=tempCanvasData.data[idx2+1],b=tempCanvasData.data[idx2+2];sumred+=r,sumgreen+=g,sumblue+=b}}var nr=sumred/25,ng=sumgreen/25,nb=sumblue/25;sumred=0,sumgreen=0,sumblue=0,canvasData.data[idx+0]=nr,canvasData.data[idx+1]=ng,canvasData.data[idx+2]=nb,canvasData.data[idx+3]=255}return canvasData},diaoke:function(tempCanvasData,canvasData){for(var x=1;x<tempCanvasData.width-1;x++)for(var y=1;y<tempCanvasData.height-1;y++){var idx=4*(x+y*tempCanvasData.width),bidx=4*(x-1+y*tempCanvasData.width),aidx=4*(x+1+y*tempCanvasData.width),nr=tempCanvasData.data[bidx+0]-tempCanvasData.data[aidx+0]+128,ng=tempCanvasData.data[bidx+1]-tempCanvasData.data[aidx+1]+128,nb=tempCanvasData.data[bidx+2]-tempCanvasData.data[aidx+2]+128;nr=0>nr?0:nr>255?255:nr,ng=0>ng?0:ng>255?255:ng,nb=0>nb?0:nb>255?255:nb,canvasData.data[idx+0]=nr,canvasData.data[idx+1]=ng,canvasData.data[idx+2]=nb,canvasData.data[idx+3]=255}return canvasData},mirror:function(tempCanvasData,canvasData){for(var x=0;x<tempCanvasData.width;x++)for(var y=0;y<tempCanvasData.height;y++){var idx=4*(x+y*tempCanvasData.width),midx=4*(tempCanvasData.width-1-x+y*tempCanvasData.width);canvasData.data[midx+0]=tempCanvasData.data[idx+0],canvasData.data[midx+1]=tempCanvasData.data[idx+1],canvasData.data[midx+2]=tempCanvasData.data[idx+2],canvasData.data[midx+3]=255}return canvasData},adjust:function(binaryData,step){for(var i=0;i<binaryData.width*binaryData.height*step;i+=step){var r=binaryData.data[i],g=binaryData.data[i+1],b=binaryData.data[i+2];binaryData.data[i]=.272*r+.534*g+.131*b,binaryData.data[i+1]=.349*r+.686*g+.168*b,binaryData.data[i+2]=.393*r+.769*g+.189*b}return binaryData}};lvjing.onclick=function(event){$(".setsize").fadeOut(),$(".lefttool").length?$(".filter").show().animate({left:"95px",opacity:1}):$(".bottool").length&&$(".filter").show().animate({bottom:"48px",opacity:1});var ich=$("#ich")[0],ichx=ich.getContext("2d");ich.width=cn.width,ich.height=cn.height,ichx.drawImage(cn,0,0,cn.width,cn.height),$("#h").click(function(){var _data=ichx.getImageData(0,0,cn.width,cn.height);cx.clearRect(0,0,cn.width,cn.height),cx.putImageData(filters.gray(_data),0,0)}),$("#blur").click(function(){var _data=ichx.getImageData(0,0,cn.width,cn.height);cx.clearRect(0,0,cn.width,cn.height),cx.putImageData(filters.blur(_data,cx.getImageData(0,0,cn.width,cn.height)),0,0)}),$("#fudiao").click(function(){var _data=ichx.getImageData(0,0,cn.width,cn.height);cx.clearRect(0,0,cn.width,cn.height),cx.putImageData(filters.fudiao(_data,cx.getImageData(0,0,cn.width,cn.height)),0,0)}),$("#diaoke").click(function(){var _data=ichx.getImageData(0,0,cn.width,cn.height);cx.clearRect(0,0,cn.width,cn.height),cx.putImageData(filters.diaoke(_data,cx.getImageData(0,0,cn.width,cn.height)),0,0)}),$("#mirror").click(function(){var _data=ichx.getImageData(0,0,cn.width,cn.height);cx.clearRect(0,0,cn.width,cn.height),cx.putImageData(filters.mirror(_data,cx.getImageData(0,0,cn.width,cn.height)),0,0)}),$("#adjust").click(function(){var _data=ichx.getImageData(0,0,cn.width,cn.height);cx.clearRect(0,0,cn.width,cn.height),cx.putImageData(filters.adjust(_data,8),0,0)}),$("#f").click(function(){var _data=ichx.getImageData(0,0,cn.width,cn.height);cx.clearRect(0,0,cn.width,cn.height),cx.putImageData(filters.fanse(_data),0,0)}),$(".s").click(function(){memery.saveCanvas(cn.width,cn.height,cx.getImageData(0,0,cn.width,cn.height)),hideHooc.canvas.width=cn.width,hideHooc.canvas.height=cn.height,hideHooc.context.clearRect(0,0,cn.width,cn.height),hideHooc.context.drawImage(cn,0,0,cn.width,cn.height);var size="";size=hooc.imginfo.preimg?hooc.imginfo:cn,hooc.resizeable&&hooc.resizeCanvas.init(size),hidefilter(),$(".btn-active").removeClass("btn-active")}),$(".c").click(function(){cx.clearRect(0,0,cn.width,cn.height),cx.drawImage(ich,0,0,cn.width,cn.height),hidefilter(),$(".btn-active").removeClass("btn-active")}),event.stopPropagation()},undo.onclick=function(){clearJieTu(),memery.go(-1,function(data){cn.width=data.width,cn.height=data.height,cx.clearRect(0,0,cn.width,cn.height),cx.putImageData(data.data,0,0)}),hideHooc.canvas.width=cn.width,hideHooc.canvas.height=cn.height,hideHooc.context.clearRect(0,0,cn.width,cn.height),hideHooc.context.drawImage(cn,0,0,cn.width,cn.height);var size="";size=hooc.imginfo.preimg?hooc.imginfo:cn,hooc.resetChiCun(),hooc.resizeable&&hooc.resizeCanvas.init(size)},redo.onclick=function(){if(null!=document.getElementById("jietuMask"))return!1;memery.go(1,function(data){cn.width=data.width,cn.height=data.height,cx.clearRect(0,0,cn.width,cn.height),cx.putImageData(data.data,0,0)}),hooc.resetChiCun(),hideHooc.context.clearRect(0,0,cn.width,cn.height),hideHooc.context.drawImage(cn,0,0,cn.width,cn.height);var size="";size=hooc.imginfo.preimg?hooc.imginfo:cn,hooc.resetChiCun(),hooc.resizeable&&hooc.resizeCanvas.init(size)}}),function(){if(/(msie 7)|(msie 8)|(msie 9)/i.test(navigator.userAgent.toLowerCase())){$("body").append('<div style="position:fixed;left:0;top:0;width:100%;height:100%;background:#000;opacity:0.35;filter:alpha(opacity:35);z-index:22222;"></div><div style="position:absolute;text-align:center;left:50%;margin-left:-300px;top:120px;width:600px;height:80px;background:#fff;border-radius:2px;line-height:80px;color:#666;z-index:22223;">当前浏览器版本较低！&nbsp;<b id="miao" style="font-size:18px;color:#999;">8</b>&nbsp;秒后网页将自动关闭，请换到现代浏览器，抱歉！</div>');var miao=8;return setInterval(function(){return miao--,0>miao?(window.close(),!1):void $("#miao").html(miao)},1e3),!1}var setFlag=function(id){$(id).addClass("current");var music=document.getElementById("music");music.volume=.3,$(".mctrl").click(function(){$(this).hasClass("play")?($(this).removeClass("play").addClass("pause"),music.play(),$(".music_stop").addClass("music_playing").removeClass("music_stop")):($(this).removeClass("pause").addClass("play"),music.pause(),$(".music_playing").addClass("music_stop").removeClass("music_playing"))})},id="index";$(".nav li").each(function(){var iid=$(this).prop("id");return iid&&-1!=location.pathname.indexOf(iid)?(id=iid,!1):void 0}),setFlag("#"+id),$(".minnav").click(function(){$(".nav").slideToggle(230)});var postzan=!0,posttimer=null,postStep=500;$(".header .zan").click(function(){if(!postzan)return!1;postzan=!1;var s=(new Date).getTime(),e=0;$.ajax({url:"/ajaxPage.html",type:"post",data:{mainType:1,url:location.href,title:document.title},error:function(){console.log("error")},success:function(data){e=(new Date).getTime(),postStep>e-s?posttimer=setTimeout(function(){postzan=!0,clearTimeout(posttimer)},postStep-(e-s)):postzan=!0;var mes=data.mes;if(0>mes)alert("可以了，谢谢亲！");else{var c=data.count;$(".header i").html("赞（"+c+"）"),$(".header .zan").attr("title",c+"人已赞")}}})}),$(".focs .icon-weibo").click(function(){var href="http://v.t.sina.com.cn/share/share.php?url="+encodeURIComponent(location.href)+"&title="+document.title;window.open(href)}),$(".focs .icon-star").click(function(){var href="http://connect.qq.com/widget/shareqq/index.html?desc=学习分享，与君共勉！&summary=花谢花菲花满楼&title="+document.title+"&url="+encodeURIComponent(location.href);window.open(href)})}()});var _hmt=_hmt||[];!function(){var hm=document.createElement("script");hm.src="//hm.baidu.com/hm.js?1d880d533f964c2a4b703b1189239fa6";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s)}(),function(){var bp=document.createElement("script");bp.src="//push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s)}();